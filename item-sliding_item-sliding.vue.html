<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>item-sliding/item-sliding.vue - Documentation</title>
    <meta name="viewport"
          content="width=device-width, initial-scale=1, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <script src="scripts/qrcode.js"></script>
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
    <link type="text/css" rel="stylesheet" href="styles/custom.css">
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-114740261-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-114740261-1');
    </script>
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>

    <section class="vimo">
        <div class="vimo__imgBox">
            <img class="vimo__imgBox--img" src="./asset/img/vimo.png">
        </div>

        <div class="vimo__title">
            <h2>VIMO</h2>
            <!--<p>beta</p>-->
            <p>基于Vue2.x的移动端Hybrid框架</p>
        </div>
        <div class="vimo__iframe">
            <iframe src="https://ghbtns.com/github-btn.html?user=vm-component&amp;repo=Vimo&amp;type=star&amp;count=true"
                    frameborder="0" scrolling="0" width="110px" height="20px"
                    class="enter-transition"
                    style=""></iframe>
            <iframe src="https://ghbtns.com/github-btn.html?user=vm-component&amp;repo=Vimo&amp;type=fork&amp;count=true"
                    frameborder="0" scrolling="0" width="95px" height="20px"
                    class="enter-transition"
                    style=""></iframe>
        </div>
    </section>
    <section class="nav__header"><h2><a href="index.html">首页 / Home</a></h2><h2><a href="https://vm-component.github.io/vimo-demo">示例 / Demo</a></h2><h2><a href="https://github.com/vm-component/vimo-start-kit">如何开始 / How To Start</a></h2><h2><a href="https://github.com/vm-component/vimo/blob/master/THEME.md">主题替换 / Change Theme</a></h2><h2><a href="https://github.com/vm-component/Vimo/blob/master/CHANGELOG.md">更新日志 / Change Log</a></h2><h2><a href="https://github.com/vm-component/vimo/blob/master/FAQ.md">常见问题 / Question</a></h2></section><h3>组件 / Components</h3><ul><li><a href="component-ActionSheet.html">ActionSheet</a><ul class='methods'><li data-type='method'><a href="component-ActionSheet.html#~dismiss">dismiss</a></li><li data-type='method'><a href="component-ActionSheet.html#~present">present</a></li></ul></li><li><a href="component-Alert.html">Alert</a><ul class='methods'><li data-type='method'><a href="component-Alert.html#~dismiss">dismiss</a></li><li data-type='method'><a href="component-Alert.html#~present">present</a></li></ul></li><li><a href="component-App.html">App</a></li><li><a href="component-Avatar.html">Avatar</a></li><li><a href="component-Backdrop.html">Backdrop</a></li><li><a href="component-Badge.html">Badge</a></li><li><a href="component-Button.html">Button</a></li><li><a href="component-Card.html">Card</a></li><li><a href="component-Card_CardContent.html">Card/CardContent</a></li><li><a href="component-Card_CardHeader.html">Card/CardHeader</a></li><li><a href="component-Card_CardTitle.html">Card/CardTitle</a></li><li><a href="component-Checkbox.html">Checkbox</a></li><li><a href="component-ChooseCity.html">ChooseCity</a><ul class='methods'><li data-type='method'><a href="component-ChooseCity.html#~present">present</a></li></ul></li><li><a href="component-CityPicker.html">CityPicker</a></li><li><a href="component-Content.html">Content</a><ul class='methods'><li data-type='method'><a href="component-Content.html#~resize">resize</a></li><li data-type='method'><a href="component-Content.html#~scrollBy">scrollBy</a></li><li data-type='method'><a href="component-Content.html#~scrollTo">scrollTo</a></li><li data-type='method'><a href="component-Content.html#~scrollToBottom">scrollToBottom</a></li><li data-type='method'><a href="component-Content.html#~scrollToElement">scrollToElement</a></li><li data-type='method'><a href="component-Content.html#~scrollToTop">scrollToTop</a></li></ul></li><li><a href="component-CountDown.html">CountDown</a></li><li><a href="component-Datetime.html">Datetime</a></li><li><a href="component-Fab.html">Fab</a><ul class='methods'><li data-type='method'><a href="component-Fab.html#~close">close</a></li></ul></li><li><a href="component-Fab_FabButton.html">Fab/FabButton</a></li><li><a href="component-Fab_FabList.html">Fab/FabList</a></li><li><a href="component-Feedback.html">Feedback</a><ul class='methods'><li data-type='method'><a href="component-Feedback.html#~destroy">destroy</a></li><li data-type='method'><a href="component-Feedback.html#~update">update</a></li></ul></li><li><a href="component-Footer.html">Footer</a><ul class='methods'><li data-type='method'><a href="component-Footer.html#~hide">hide</a></li><li data-type='method'><a href="component-Footer.html#~setStyle">setStyle</a></li><li data-type='method'><a href="component-Footer.html#~show">show</a></li><li data-type='method'><a href="component-Footer.html#~toggle">toggle</a></li></ul></li><li><a href="component-Grid.html">Grid</a></li><li><a href="component-Grid_Column.html">Grid/Column</a></li><li><a href="component-Grid_Row.html">Grid/Row</a></li><li><a href="component-Header.html">Header</a><ul class='methods'><li data-type='method'><a href="component-Header.html#~hide">hide</a></li><li data-type='method'><a href="component-Header.html#~setStyle">setStyle</a></li><li data-type='method'><a href="component-Header.html#~show">show</a></li><li data-type='method'><a href="component-Header.html#~toggle">toggle</a></li></ul></li><li><a href="component-Icon.html">Icon</a></li><li><a href="component-Img.html">Img</a></li><li><a href="component-InfiniteScroll.html">InfiniteScroll</a><ul class='methods'><li data-type='method'><a href="component-InfiniteScroll.html#~complete">complete</a></li><li data-type='method'><a href="component-InfiniteScroll.html#~enable">enable</a></li><li data-type='method'><a href="component-InfiniteScroll.html#~waitFor">waitFor</a></li></ul></li><li><a href="component-InfiniteScroll_InfiniteScrollContent.html">InfiniteScroll/InfiniteScrollContent</a></li><li><a href="component-Input.html">Input</a></li><li><a href="component-Item.html">Item</a></li><li><a href="component-Item_ItemCollapse.html">Item/ItemCollapse</a></li><li><a href="component-Item_ItemCollapseGroup.html">Item/ItemCollapseGroup</a></li><li><a href="component-Item_ItemDivider.html">Item/ItemDivider</a></li><li><a href="component-Item_ItemGroup.html">Item/ItemGroup</a></li><li><a href="component-Item_ItemSliding.html">Item/ItemSliding</a><ul class='methods'><li data-type='method'><a href="component-Item_ItemSliding.html#~close">close</a></li><li data-type='method'><a href="component-Item_ItemSliding.html#~getOpenAmount">getOpenAmount</a></li><li data-type='method'><a href="component-Item_ItemSliding.html#~getSlidingPercent">getSlidingPercent</a></li><li data-type='method'><a href="component-Item_ItemSliding.html#~openLeftOptions">openLeftOptions</a></li><li data-type='method'><a href="component-Item_ItemSliding.html#~openRightOptions">openRightOptions</a></li></ul></li><li><a href="component-Item_ItemSlidingOptions.html">Item/ItemSlidingOptions</a></li><li><a href="component-Item_ListHeader.html">Item/ListHeader</a></li><li><a href="component-Label.html">Label</a></li><li><a href="component-LandscapePrompt.html">LandscapePrompt</a></li><li><a href="component-List.html">List</a></li><li><a href="component-Loading.html">Loading</a></li><li><a href="component-Menu.html">Menu</a><ul class='methods'><li data-type='method'><a href="component-Menu.html#~close">close</a></li><li data-type='method'><a href="component-Menu.html#~open">open</a></li><li data-type='method'><a href="component-Menu.html#~toggle">toggle</a></li></ul></li><li><a href="component-Modal.html">Modal</a><ul class='methods'><li data-type='method'><a href="component-Modal.html#~dismiss">dismiss</a></li><li data-type='method'><a href="component-Modal.html#~present">present</a></li></ul></li><li><a href="component-Nav.html">Nav</a></li><li><a href="component-Navbar.html">Navbar</a><ul class='methods'><li data-type='method'><a href="component-Navbar.html#~hideOptionButton">hideOptionButton</a></li><li data-type='method'><a href="component-Navbar.html#~reset">reset</a></li><li data-type='method'><a href="component-Navbar.html#~showOptionButton">showOptionButton</a></li><li data-type='method'><a href="component-Navbar.html#~showPopMenu">showPopMenu</a></li></ul></li><li><a href="component-Note.html">Note</a></li><li><a href="component-NoticeBar.html">NoticeBar</a><ul class='methods'><li data-type='method'><a href="component-NoticeBar.html#~close">close</a></li></ul></li><li><a href="component-Page.html">Page</a></li><li><a href="component-Picker.html">Picker</a></li><li><a href="component-Popover.html">Popover</a></li><li><a href="component-PopSheet.html">PopSheet</a></li><li><a href="component-PreviewImage.html">PreviewImage</a></li><li><a href="component-Radio.html">Radio</a></li><li><a href="component-Range.html">Range</a></li><li><a href="component-Refresher.html">Refresher</a><ul class='methods'><li data-type='method'><a href="component-Refresher.html#~cancel">cancel</a></li><li data-type='method'><a href="component-Refresher.html#~complete">complete</a></li></ul></li><li><a href="component-Refresher_RefresherContent.html">Refresher/RefresherContent</a></li><li><a href="component-Scroll.html">Scroll</a></li><li><a href="component-ScrollSegment.html">ScrollSegment</a></li><li><a href="component-ScrollSegment_ScrollSegmentButton.html">ScrollSegment/ScrollSegmentButton</a></li><li><a href="component-Searchbar.html">Searchbar</a><ul class='methods'><li data-type='method'><a href="component-Searchbar.html#~setFocus">setFocus</a></li></ul></li><li><a href="component-Segment.html">Segment</a></li><li><a href="component-Segment_SegmentButton.html">Segment/SegmentButton</a></li><li><a href="component-Select.html">Select</a></li><li><a href="component-Select_SelectOption.html">Select/SelectOption</a></li><li><a href="component-Separation.html">Separation</a></li><li><a href="component-Sheet.html">Sheet</a></li><li><a href="component-SlideBox.html">SlideBox</a><ul class='methods'><li data-type='method'><a href="component-SlideBox.html#~cancel">cancel</a></li><li data-type='method'><a href="component-SlideBox.html#~checking">checking</a></li><li data-type='method'><a href="component-SlideBox.html#~complete">complete</a></li><li data-type='method'><a href="component-SlideBox.html#~fail">fail</a></li></ul></li><li><a href="component-Slides.html">Slides</a></li><li><a href="component-Slides_Slide.html">Slides/Slide</a></li><li><a href="component-SlidesLite.html">SlidesLite</a></li><li><a href="component-SlidesLite_Slide.html">SlidesLite/Slide</a></li><li><a href="component-Spinner.html">Spinner</a></li><li><a href="component-Tabs.html">Tabs</a><ul class='methods'><li data-type='method'><a href="component-Tabs.html#~getActivatedIndex">getActivatedIndex</a></li><li data-type='method'><a href="component-Tabs.html#~getByIndex">getByIndex</a></li><li data-type='method'><a href="component-Tabs.html#~getSelected">getSelected</a></li><li data-type='method'><a href="component-Tabs.html#~select">select</a></li></ul></li><li><a href="component-Tabs_Tab.html">Tabs/Tab</a></li><li><a href="component-Textarea.html">Textarea</a><ul class='methods'><li data-type='method'><a href="component-Textarea.html#~destroy">destroy</a></li><li data-type='method'><a href="component-Textarea.html#~update">update</a></li></ul></li><li><a href="component-Thumbnail.html">Thumbnail</a></li><li><a href="component-Toast.html">Toast</a></li><li><a href="component-ToastState.html">ToastState</a></li><li><a href="component-Toggle.html">Toggle</a></li><li><a href="component-Toolbar.html">Toolbar</a></li><li><a href="component-Toolbar_Buttons.html">Toolbar/Buttons</a></li><li><a href="component-Toolbar_Title.html">Toolbar/Title</a><ul class='methods'><li data-type='method'><a href="component-Toolbar_Title.html#~getTitle">getTitle</a></li><li data-type='method'><a href="component-Toolbar_Title.html#~reset">reset</a></li><li data-type='method'><a href="component-Toolbar_Title.html#~setTitle">setTitle</a></li><li data-type='method'><a href="component-Toolbar_Title.html#~setTitleColor">setTitleColor</a></li></ul></li></ul><h3>Global</h3><ul><li><a href="global.html#setClass">setClass</a></li><li><a href="global.html#setDisableScroll">setDisableScroll</a></li><li><a href="global.html#setDocTitle">setDocTitle</a></li><li><a href="global.html#setEnabled">setEnabled</a></li></ul>
</nav>

<div id="main">

    <article class="content">

        
        <h1 class="page-title">item-sliding/item-sliding.vue</h1>
        

        




    <section>
        <article>
            <pre class="prettyprint source linenums"><code>&lt;template>
    &lt;div class="ion-item-sliding item-wrapper"
         @touchstart="onDragStart"
         @touchend="onDragEnd"
         @touchmove="onDragMove"
         :class="activeClass">
        &lt;slot>&lt;/slot>
    &lt;/div>
&lt;/template>
&lt;style lang="scss" src="./style.scss">&lt;/style>
&lt;script type="text/javascript">
  /**
   * @component Item/ItemSliding
   * @description
   *
   * ## 列表组件 / ItemSliding滑动选择组件
   *
   * 这个组件是对Item组件的拓展, 当左右滑动时出现可选择的按钮, 这个组件在部分安卓机上卡顿明显, 使用起来效果不太好, 但是在IOS上很流畅.
   *
   *
   * ### 子组件ItemSlidingOptions
   *
   * ItemSlidingOptions只能在ItemSliding组件中使用
   *
   * ### 如何使用
   *
   * ```
   * // 引入
   * import { ItemSlidingOptions, ItemSliding } from 'vimo'
   * // 安装
   * export default{
   *   components: { ItemSlidingOptions, ItemSliding }
   * }
   * ```
   *
   *
   * @props {Boolean} disabled - 是否禁用
   *
   * @fires component:ItemSliding#onDrag
   * @fires component:ItemSliding#onSwipe
   * @fires component:ItemSliding#onSwipeRight
   * @fires component:ItemSliding#onSwipeLeft
   *
   * @demo #/slidingList
   * @see component:ItemOptions
   *
   * @usage
   *
   * &lt;ItemSliding>
   *    &lt;Item>
   *        &lt;Avatar slot="item-left">
   *            &lt;img src="./img/avatar-ts-woody.png">
   *        &lt;/Avatar>
   *        &lt;Label>
   *            &lt;h2>两边都有按钮&lt;/h2>
   *            &lt;p>试试 ↔️️ 都滑动&lt;/p>
   *        &lt;/Label>
   *    &lt;/Item>
   *    &lt;ItemSlidingOptions side="left">
   *        &lt;Button color="primary" @click="clickText">
   *            &lt;Icon name="text">&lt;/Icon>
   *            &lt;span>Text&lt;/span>
   *        &lt;/Button>
   *        &lt;Button color="secondary" @click="clickCall">
   *            &lt;Icon name="call">&lt;/Icon>
   *            &lt;span>Call&lt;/span>
   *        &lt;/Button>
   *     &lt;/ItemSlidingOptions>
   *     &lt;ItemSlidingOptions side="right">
   *        &lt;Button color="primary" @click="clickEmail">
   *            &lt;Icon name="mail">&lt;/Icon>
   *            &lt;span>Email&lt;/span>
   *        &lt;/Button>
   *    &lt;/ItemSlidingOptions>
   * &lt;/ItemSliding>
   * */
  import { pointerCoord, transitionEnd } from '../../util/util.js'

  const SWIPE_MARGIN = 30 * 2 // 触发swipe的值
  const ELASTIC_FACTOR = 0.55 // 0.55
  const ITEM_SIDE_FLAGS = {
    None: 0,
    Left: 1,
    Right: 2,
    Both: 3
  }
  const SLIDING_STATE = {
    Disabled: 2,            // 关闭状态
    Enabled: 4,             // 滑动状态, 不清楚方向和程度
    Right: 8,               // 向右滑动
    Left: 16,               // 向左滑动
    SwipeRight: 32,         // 向右滑动且滑动距离大
    SwipeLeft: 64          // 向左滑动且滑动距离大
  }

  const DIRECTION_NONE = 1
  const DIRECTION_LEFT = 2
  const DIRECTION_RIGHT = 4
  const DIRECTION_UP = 8
  const DIRECTION_DOWN = 16

  const MAX_DELTAX = 20

  export default {
    name: 'ItemSliding',
    data () {
      return {
        timer: null,
        isDragging: false,                      // 是否正在左右滑动
        isDraggingConfirm: false,               // 当次滚动方向确认与否
        isDraggingFromStart: false,             // 滚动是否从start开始

        itemComponent: null,                     // 父组件Item的实例
        ListComponent: null,                     // 父组件List的实例

        leftOptions: null,                      // 左边的选项 实例
        rightOptions: null,                     // 右边的选项 实例
        optsWidthRightSide: 0,                  // 右边选项的宽度 number
        optsWidthLeftSide: 0,                   // 左边选项的宽度 number

        openAmount: 0,                          // 开启值 number
        startX: 0,                              // 初始的位置 number

        sides: 0,                               // 当前滑动的方向 ItemSideFlags的枚举值 标识options的left/right/both的状态
        unregister: null,                       // itemComponent组件关闭动画的解绑函数

        optsDirty: true,                        // boolean true:还未计算options的宽度，false:已计算
        state: SLIDING_STATE.Disabled,           // 滑动程度及状态
        firstCoord: 0,                          // {x,y} 记录点击开始的位置，用于计算速度
        firstTimestamp: new Date().getTime(),   // number 记录点击开始的时间，用于计算速度
        activeClass: {}                        // 根据滑动状态设置active的class类型
      }
    },
    props: {
      disabled: Boolean
    },
    methods: {

      /**
       * @function getOpenAmount
       * @description
       * 获取ion-item的开启值
       * @return {number}
       * */
      getOpenAmount () {
        return this.openAmount
      },

      /**
       * @function getSlidingPercent
       * @description
       * 获取开口的百分比
       * @return {number}
       * */
      getSlidingPercent () {
        let openAmount = this.openAmount
        if (openAmount > 0) {
          return openAmount / this.optsWidthRightSide
        } else if (openAmount &lt; 0) {
          return openAmount / this.optsWidthLeftSide
        } else {
          return 0
        }
      },

      /**
       * @function openLeftOptions
       * @description
       * 开启左边的选项卡
       * @return {*} ins - 开启的组件示例的this，默认是当前组件自己的this
       * */
      openLeftOptions (ins = this) {
        if (ins === this &amp;&amp; this.leftOptions) {
          if (this.state === SLIDING_STATE.Left || this.state === SLIDING_STATE.SwipeLeft) {
            return
          }
          this.activeClass = {
            'active-slide': true
          }
          this.$nextTick(() => {
            if (this.optsDirty) {
              this.calculateOptsWidth()
            }
            if (this.optsWidthLeftSide > 0) {
              this.setOpenAmount(-this.optsWidthLeftSide, false)
            }
          })
        }
      },

      /**
       * @function openRightOptions
       * @description
       * 开启右边的选项卡
       * @return {*} ins - 开启的组件示例的this，默认是当前组件自己的this
       * */
      openRightOptions (ins = this) {
        if (ins === this &amp;&amp; this.rightOptions) {
          if (this.state === SLIDING_STATE.Right || this.state === SLIDING_STATE.SwipeRight) {
            return
          }
          this.activeClass = {
            'active-slide': true
          }
          this.$nextTick(() => {
            if (this.optsDirty) {
              this.calculateOptsWidth()
            }
            if (this.optsWidthRightSide > 0) {
              this.setOpenAmount(this.optsWidthRightSide, false)
            }
          })
        }
      },

      /**
       * @function close
       * @description
       * 关闭当前的sliding
       * */
      close () {
        // 关闭的条件：必须是开启状态，并且不是disable状态
        if (Math.abs(this.openAmount) > 0 &amp;&amp; this.state !== SLIDING_STATE.Disabled) {
          this.setOpenAmount(0, true)
        }
      },

      // ------------- @private -------------

      /**
       * 判断是否能拖动
       * @private
       * */
      canDrag () {
        if (this.disabled) return false

        // 表示还在动画transition中
        if (this.unregister) {
          this.unregister()
          this.unregister = null
        }

        return true
      },

      /**
       * onDragStart
       * @param {any} ev
       * @return {*}
       * @private
       */
      onDragStart (ev) {
        if (!this.canDrag()) return
        this.firstCoord = pointerCoord(ev)
        this.firstTimestamp = new Date().getTime()
        this.startSliding(this.firstCoord.x)
        this.$root &amp;&amp; this.$root.$emit('onItemSlidingOpen', this)
        this.isDraggingFromStart = true
      },

      /**
       * onDragMove
       * @param {any} ev
       * @return {*}
       * @private
       */
      onDragMove (ev) {
        if (!this.canDrag()) return
        if (!this.isDraggingFromStart) return false
        let coordX = pointerCoord(ev).x

        // 判断当前的移动是滚动还是组件的左右移动
        if (!this.isDraggingConfirm &amp;&amp; Math.abs(coordX - this.firstCoord.x) > MAX_DELTAX) {
          this.isDraggingConfirm = true

          let directionCode = this.getDirection(this.firstCoord, pointerCoord(ev))
          if (directionCode === DIRECTION_LEFT || directionCode === DIRECTION_RIGHT) {
            this.isDragging = true
            ev.preventDefault &amp;&amp; ev.preventDefault()
          } else {
            this.isDragging = false
          }
        }

        if (this.isDraggingConfirm &amp;&amp; this.isDragging) {
          this.moveSliding(coordX)
          ev.preventDefault &amp;&amp; ev.preventDefault()
        }
      },

      /**
       * onDragEnd
       * @param {any} ev
       * @private
       */
      onDragEnd (ev) {
        let coordX = pointerCoord(ev).x
        let deltaX = (coordX - this.firstCoord.x)
        let deltaT = (Date.now() - this.firstTimestamp)
        if (deltaX === 0) {
          this.close()
        } else {
          this.endSliding(deltaX / deltaT)
        }
        this.isDragging = false
        this.isDraggingConfirm = false
        this.isDraggingFromStart = false

        if (this.openAmount === 0 &amp;&amp; !this.unregister) {
          // 如果点击结束后, 组件未开启, 且未动画, 则设为disabled状态
          window.setTimeout(() => {
            this.activeClass = {'active-slide': false}
          }, 300)
          this.state = SLIDING_STATE.Disabled
        }
      },

      /**
       * 获取方向
       * @private
       */
      getDirection (start, end) {
        let deltaX = end.x - start.x
        let deltaY = end.y - start.y

        if (deltaX > 0 &amp;&amp; Math.abs(deltaX) > Math.abs(deltaY)) {
          return DIRECTION_RIGHT
        }

        if (deltaX &lt; 0 &amp;&amp; Math.abs(deltaX) > Math.abs(deltaY)) {
          return DIRECTION_LEFT
        }

        if (deltaY > 0 &amp;&amp; Math.abs(deltaX) &lt; Math.abs(deltaY)) {
          return DIRECTION_DOWN
        }

        if (deltaY &lt; 0 &amp;&amp; Math.abs(deltaX) &lt; Math.abs(deltaY)) {
          return DIRECTION_UP
        }

        return DIRECTION_NONE
      },

      /**
       * 初始化：获取子组件实例，ItemSideFlags状态变更
       * @private
       * */
      init () {
        // 获取子组件实例
        let side = 0 // ITEM_SIDE_FLAGS None=0
        let componentIs = (component, name = '') => {
          return component.$options &amp;&amp; component.$options._componentTag &amp;&amp; component.$options._componentTag.toLowerCase() === name.toLowerCase()
        }

        this.$children.forEach((item) => {
          if (componentIs(item, 'item')) {
            this.itemComponent = item
          }
          if (componentIs(item, 'ItemSlidingOptions') &amp;&amp; item.side === 'left') {
            this.leftOptions = item
            side |= this.getSides(item)
          }
          if (componentIs(item, 'ItemSlidingOptions') &amp;&amp; item.side === 'right') {
            this.rightOptions = item
            side |= this.getSides(item)
          }
        })

        // ITEM_SIDE_FLAGS 的状态记录
        this.sides = side // option的可滑动方向 none:0 left:1 right:2 both:3
        this.optsDirty = true

        //  事件注册
        this.$root &amp;&amp; this.$root.$on('onItemSlidingOpen', (ins) => {
          if (this !== ins) {
            this.close()
          }
        })
        this.$root &amp;&amp; this.$root.$on('onScroll', () => {
          this.close()
        })
      },

      /**
       * 设置起始点，因为有原始点与options点
       * @param {number} startX
       * @private
       * */
      startSliding (startX) {
        if (this.openAmount === 0) {
          this.setState(SLIDING_STATE.Enabled)
        }
        this.startX = startX + this.openAmount
      },

      /**
       * 计算openAmount，算入阻尼，最后执行item定位
       * @param {number} x
       * @return {number}
       * @private
       */
      moveSliding (x) {
        if (this.optsDirty) {
          this.calculateOptsWidth()
          return 0
        }
        let openAmount = (this.startX - x)
        switch (this.sides) {
          case ITEM_SIDE_FLAGS.Right:
            openAmount = Math.max(0, openAmount)
            break
          case ITEM_SIDE_FLAGS.Left:
            openAmount = Math.min(0, openAmount)
            break
          case ITEM_SIDE_FLAGS.Both:
            break
          case ITEM_SIDE_FLAGS.None:
            return 0
          default:
            console.assert(false, 'invalid ITEM_SIDE_FLAGS value')
            break
        }

        if (openAmount > this.optsWidthRightSide) {
          let optsWidth = this.optsWidthRightSide
          openAmount = optsWidth + (openAmount - optsWidth) * ELASTIC_FACTOR
        } else if (openAmount &lt; -this.optsWidthLeftSide) {
          let optsWidth = -this.optsWidthLeftSide
          openAmount = optsWidth + (openAmount - optsWidth) * ELASTIC_FACTOR
        }
        this.setOpenAmount(openAmount, false)
        return openAmount
      },

      /**
       * 松手后的移动特性决定最终停在哪个位置
       * @param {number} velocity 移动速度(惯性)
       * @return {number}
       * @private
       */
      endSliding (velocity) {
        // 松手后的停留点
        let restingPoint = (this.openAmount > 0)
          ? this.optsWidthRightSide
          : -this.optsWidthLeftSide

        // Check if the drag didn't clear the buttons mid-point
        // and we aren't moving fast enough to swipe open
        let isResetDirection = (this.openAmount > 0) === !(velocity &lt; 0)
        let isMovingFast = Math.abs(velocity) > 0.3
        let isOnCloseZone = Math.abs(this.openAmount) &lt; Math.abs(restingPoint / 2)
        if (swipeShouldReset(isResetDirection, isMovingFast, isOnCloseZone)) {
          restingPoint = 0
        }

        this.setOpenAmount(restingPoint, true)

        this.fireSwipeEvent()
        return restingPoint
      },

      /**
       * 计算子组件的左右options的宽度
       * @private
       * */
      calculateOptsWidth () {
        if (!this.optsDirty) {
          return
        }
        this.optsWidthRightSide = 0
        if (this.rightOptions) {
          this.optsWidthRightSide = this.rightOptions.width()
        }
        this.optsWidthLeftSide = 0
        if (this.leftOptions) {
          this.optsWidthLeftSide = this.leftOptions.width()
        }
        this.optsDirty = false
      },

      /**
       * 获取options子组件的side属性对应的ItemSideFlags值
       * @param {any} ins options子组件的实例
       * @private
       * */
      getSides (ins) {
        if (ins.side === 'left') {
          return ITEM_SIDE_FLAGS.Left
        } else {
          return ITEM_SIDE_FLAGS.Right
        }
      },

      /**
       * 根据openAmount设置item的开闭位置
       * @param {number} openAmount
       * @param {boolean} isFinal - 是否关闭(随手拖动 还是 松手关闭)
       * @private
       * */
      setOpenAmount (openAmount, isFinal) {
        this.openAmount = openAmount
        if (isFinal) {
          // 松手关闭状态, 可以是到起始位置, 也可以是到中途点, 全部打回初始状态
          this.isDragging = false
          this.isDraggingConfirm = false
          this.isDraggingFromStart = false
          this.unregister &amp;&amp; this.unregister()
          if (openAmount === 0) {
            // 动画过程禁止点击操作
            this.unregister = transitionEnd(this.itemComponent.$el, () => {
              this.setState(SLIDING_STATE.Disabled)
              this.unregister = null
            })
            this.setItemTransformX(0)
          } else {
            this.unregister = transitionEnd(this.itemComponent.$el, () => {
              this.unregister = null
            })
            this.setItemTransformX(-openAmount)
          }
        } else {
          // 随手滚动阶段
          if (openAmount > 0) {
            let state = (openAmount >= (this.optsWidthRightSide + SWIPE_MARGIN))
              ? SLIDING_STATE.Right | SLIDING_STATE.SwipeRight
              : SLIDING_STATE.Right
            this.setState(state)
          } else if (openAmount &lt; 0) {
            let state = (openAmount &lt;= (-this.optsWidthLeftSide - SWIPE_MARGIN))
              ? SLIDING_STATE.Left | SLIDING_STATE.SwipeLeft
              : SLIDING_STATE.Left
            this.setState(state)
          }

          this.setItemTransformX(-openAmount)
          /**
           * @event component:ItemSliding#onDrag
           * @description 正在拖动时触发
           * @property {ItemSlidingComponent} this - 当前ItemSliding实例
           */
          this.$emit('onDrag', this)
        }
      },

      /**
       * @param {String} state
       * @private
       * */
      setState (state) {
        if (state === this.state) return

        this.timer &amp;&amp; window.clearTimeout(this.timer)
        this.activeClass = {
          'active-slide': true,
          'active-options-right': (state &amp; SLIDING_STATE.Right),
          'active-options-left': (state &amp; SLIDING_STATE.Left),
          'active-swipe-right': (state &amp; SLIDING_STATE.SwipeRight),
          'active-swipe-left': (state &amp; SLIDING_STATE.SwipeLeft)
        }

        // bugFix
        if (state === SLIDING_STATE.Disabled) {
          this.timer = window.setTimeout(() => {
            this.activeClass['active-slide'] = false
          }, 16 * 5)
        }

        this.state = state
      },

      /**
       * 设置子组件ion-item的transformX属性
       * @param {number} val
       * @private
       * */
      setItemTransformX (val = 0) {
        if (this.itemComponent) {
          window.requestAnimationFrame(() => {
            this.itemComponent.$el.style.transform = `translate3d(${val >> 0}px, 0px, 0px)`
          })
        }
      },

      /**
       * 对外发出swipe事件，
       * @param {number} val
       * @private
       * */
      fireSwipeEvent () {
        if (this.state &amp; SLIDING_STATE.SwipeRight) {
          /**
           * @event component:ItemSliding#onSwipe
           * @description 当滑动超过一定阈值时触发, 这个事件不确定方向
           * @property {ItemSlidingComponent} this - 当前ItemSliding实例
           */
          /**
           * @event component:ItemSliding#onSwipeLeft
           * @description 向左滑动 超过按钮最大距离+SWIPE_MARGIN时触
           * @property {ItemSlidingComponent} this - 当前ItemSliding实例
           */
          this.$emit('onSwipe', this)
          this.$emit('onSwipeLeft', this)
        } else if (this.state &amp; SLIDING_STATE.SwipeLeft) {
          /**
           * @event component:ItemSliding#onSwipeRight
           * @description 向右滑动 超过按钮最大距离+SWIPE_MARGIN时触发
           * @property {ItemSlidingComponent} this - 当前ItemSliding实例
           */
          this.$emit('onSwipe', this)
          this.$emit('onSwipeRight', this)
        }
      }
    },
    mounted () {
      // 此时子组件才初始化完毕
      this.init()
    },
    destroyed () {
      this.$root &amp;&amp; this.$root.$off('onItemSlidingOpen')
      this.$root &amp;&amp; this.$root.$off('onScroll')
    }
  }

  /**
   * 根据传入条件判断是否执行swipeReset
   * @param {boolean} isResetDirection
   * @param {boolean} isMovingFast
   * @param {boolean} isOnResetZone
   * @return {boolean}
   * @private
   */
  function swipeShouldReset (isResetDirection, isMovingFast, isOnResetZone) {
    // The logic required to know when the sliding item should close (openAmount=0)
    // depends on three booleans (isCloseDirection, isMovingFast, isOnCloseZone)
    // and it ended up being too complicated to be written manually without errors
    // so the truth table is attached below: (0=false, 1=true)
    // isCloseDirection | isMovingFast | isOnCloseZone || shouldClose
    //         0        |       0      |       0       ||    0
    //         0        |       0      |       1       ||    1
    //         0        |       1      |       0       ||    0
    //         0        |       1      |       1       ||    0
    //         1        |       0      |       0       ||    0
    //         1        |       0      |       1       ||    1
    //         1        |       1      |       0       ||    1
    //         1        |       1      |       1       ||    1
    // The resulting expression was generated by resolving the K-map (Karnaugh map):
    let shouldClose = (!isMovingFast &amp;&amp; isOnResetZone) || (isResetDirection &amp;&amp; isMovingFast)
    return shouldClose
  }
&lt;/script>
</code></pre>
        </article>
    </section>





    </article>
</div>

<br class="clear">

<!--<footer>-->
    <!--文档根据<a href="https://github.com/vm-component/Vimo">Vimo源码</a>由<a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a>自动生成, 主题修改自<a href="https://github.com/clenemt/docdash">docdash</a>, 并增加了 @component / @demo / @props / @slot / @usage 增强标注.-->
<!--</footer>-->

<footer>
    文档根据<a href="https://github.com/vm-component/Vimo">Vimo源码</a>由<a href="https://github.com/jsdoc3/jsdoc">JSDoc3.5.5</a>自动生成。
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>
